# TaskBasedWorkflow

ã‚¿ã‚¹ã‚¯ãƒ™ãƒ¼ã‚¹ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚Planner ãŒç›®æ¨™ã‚’åˆ†æã—ã¦ã‚¿ã‚¹ã‚¯è¨ˆç”»ã‚’ä½œæˆã—ã€å°‚é–€å®¶ Worker ãŒã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã—ã€ã‚µãƒãƒªãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒæœ€çµ‚å›ç­”ã‚’ã¾ã¨ã‚ã¾ã™ã€‚

## æ¦‚è¦

TaskBasedWorkflow ã¯ã€ä»¥ä¸‹ã® 3 ã¤ã®ãƒ•ã‚§ãƒ¼ã‚ºã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™:

1. **Planner ãƒ•ã‚§ãƒ¼ã‚º**: ç›®æ¨™ã‚’åˆ†æã—ã€ã‚¿ã‚¹ã‚¯è¨ˆç”»ï¼ˆã‚¿ã‚¹ã‚¯ä¸€è¦§ã¨æ‹…å½“è€…ï¼‰ã‚’ä½œæˆ
2. **Worker ãƒ•ã‚§ãƒ¼ã‚º**: å„å°‚é–€å®¶ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸã‚¿ã‚¹ã‚¯ã‚’é †æ¬¡å®Ÿè¡Œ
3. **Summary ãƒ•ã‚§ãƒ¼ã‚º**: ã‚µãƒãƒªãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒã‚¿ã‚¹ã‚¯çµæœã‚’çµ±åˆã—ã€æ§‹é€ åŒ–ã•ã‚ŒãŸæœ€çµ‚å›ç­”ã‚’ç”Ÿæˆ

```
User â†’ Planner (è¨ˆç”»ä½œæˆ) â†’ Workers (ã‚¿ã‚¹ã‚¯å®Ÿè¡Œ) â†’ Summary Agent (çµ±åˆã‚µãƒãƒªãƒ¼)
```

## ä¸»ãªç‰¹å¾´

### 1. å‹•çš„ã‚¿ã‚¹ã‚¯è¨ˆç”»

Planner ãŒç›®æ¨™ã‚’åˆ†æã—ã€å¿…è¦ãªã‚¿ã‚¹ã‚¯ã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™ã€‚å„ã‚¿ã‚¹ã‚¯ã«ã¯ä»¥ä¸‹ãŒå«ã¾ã‚Œã¾ã™:

- ã‚¿ã‚¹ã‚¯ ID
- ã‚¿ã‚¹ã‚¯ã®èª¬æ˜
- å—ã‘å…¥ã‚ŒåŸºæº–
- æ‹…å½“å°‚é–€å®¶

### 2. ã‚¿ã‚¹ã‚¯ãƒœãƒ¼ãƒ‰

ã‚¿ã‚¹ã‚¯ã®çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹ã‚¿ã‚¹ã‚¯ãƒœãƒ¼ãƒ‰ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™:

- **Queued**: å®Ÿè¡Œå¾…ã¡
- **Doing**: å®Ÿè¡Œä¸­
- **Done**: å®Œäº†
- **Blocked**: ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆã‚¨ãƒ©ãƒ¼ï¼‰

### 3. å°‚é–€å®¶ Worker

ä»¥ä¸‹ã® 6 ã¤ã®å°‚é–€å®¶ãŒåˆ©ç”¨å¯èƒ½ã§ã™:

- **Contract**: å¥‘ç´„é–¢é€£ã®å°‚é–€å®¶
- **Spend**: æ”¯å‡ºåˆ†æã®å°‚é–€å®¶
- **Negotiation**: äº¤æ¸‰æˆ¦ç•¥ã®å°‚é–€å®¶
- **Sourcing**: èª¿é”æˆ¦ç•¥ã®å°‚é–€å®¶
- **Knowledge**: çŸ¥è­˜ç®¡ç†ã®å°‚é–€å®¶
- **Supplier**: ã‚µãƒ—ãƒ©ã‚¤ãƒ¤ãƒ¼ç®¡ç†ã®å°‚é–€å®¶

### 4. é †æ¬¡å®Ÿè¡Œ

ã‚¿ã‚¹ã‚¯ã¯è¨ˆç”»ã•ã‚ŒãŸé †åºã§é †æ¬¡å®Ÿè¡Œã•ã‚Œã€é€²æ—ãŒå¯è¦–åŒ–ã•ã‚Œã¾ã™ã€‚

### 5. æ§‹é€ åŒ–ã‚µãƒãƒªãƒ¼

ã™ã¹ã¦ã®ã‚¿ã‚¹ã‚¯ãŒå®Œäº†ã™ã‚‹ã¨ã€ã‚µãƒãƒªãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒä»¥ä¸‹ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§çµ±åˆãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¾ã™ã€‚

- `### æœ€çµ‚å›ç­”` ã§è³ªå•ã«å¯¾ã™ã‚‹ç›´æ¥çš„ãªå›ç­”ã‚’ç®‡æ¡æ›¸ãã§æç¤º
- `### è¦ç´„`ã€`### è©³ç´°`ã€`### ä¸»è¦ãƒªã‚¹ã‚¯`ã€`### æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³` ã§è¦ç‚¹ã‚’æ•´ç†
- `### å‚è€ƒå›ç­”` ã«å„ã‚¿ã‚¹ã‚¯ã®å›ç­”å…¨æ–‡ã‚’ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã§æ·»ä»˜

### 6. OpenTelemetry é€£æº

ãƒ­ã‚°ã¨ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’ OpenTelemetry ã§åé›†ã—ã¾ã™ã€‚OTLP ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ `http://localhost:4317`ï¼‰ã¨ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«é€ä¿¡ã•ã‚Œã€å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè¡Œã¯ `Activity` ã¨ã—ã¦è¨˜éŒ²ã•ã‚Œã¾ã™ã€‚

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    User     â”‚
â”‚  (ç›®æ¨™å…¥åŠ›) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Planner Agent  â”‚
â”‚ (ã‚¿ã‚¹ã‚¯è¨ˆç”»ä½œæˆ) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   TaskBoard     â”‚
â”‚  (ã‚¿ã‚¹ã‚¯ç®¡ç†)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Worker Agents           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚ â”‚Contractâ”‚ â”‚ Spend  â”‚ ...  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Summary Agent     â”‚
â”‚  (çµ±åˆã‚µãƒãƒªãƒ¼ç”Ÿæˆ)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Structured Final Reportâ”‚
â”‚   (æœ€çµ‚å›ç­”å‡ºåŠ›)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ä½¿ç”¨æ–¹æ³•

### å‰ææ¡ä»¶

- .NET 8.0 SDK
- Azure OpenAI ã‚¢ã‚¯ã‚»ã‚¹
- ç’°å¢ƒå¤‰æ•°ã®è¨­å®š:
  - `AZURE_OPENAI_ENDPOINT`
  - `AZURE_OPENAI_DEPLOYMENT_NAME`
  - Azure CLI èªè¨¼ (`az login`)

ç’°å¢ƒå¤‰æ•°ã¯ `appsettings.json` / `appsettings.Development.json` ã® `environmentVariables` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«è¨˜è¼‰ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

### å®Ÿè¡Œ

```bash
cd src/TaskBasedWorkflow
dotnet run
```

å®Ÿè¡Œå¾Œã€ç›®æ¨™ã‚’å…¥åŠ›ã™ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚`exit` ã‚’å…¥åŠ›ã™ã‚‹ã¨çµ‚äº†ã—ã¾ã™ã€‚

### å®Ÿè¡Œä¾‹ï¼ˆæŠœç²‹ï¼‰

```text
è³ªå•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (çµ‚äº†ã™ã‚‹ã«ã¯ 'exit' ã¨å…¥åŠ›):
> æ–°ã—ã„ã‚µãƒ—ãƒ©ã‚¤ãƒ¤ãƒ¼ã¨ã®å¥‘ç´„ã‚’ç· çµã—ãŸã„

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ãƒ•ã‚§ãƒ¼ã‚º 1: Planner ãŒã‚¿ã‚¹ã‚¯è¨ˆç”»ã‚’ä½œæˆ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

[Planner ã®è¨ˆç”»]
{
  "tasks": [
    {
      "id": "task-1",
      "description": "ã‚µãƒ—ãƒ©ã‚¤ãƒ¤ãƒ¼ã®è©•ä¾¡ã¨é¸å®š",
      "acceptance": "è©•ä¾¡åŸºæº–ã«åŸºã¥ãé©åˆ‡ãªã‚µãƒ—ãƒ©ã‚¤ãƒ¤ãƒ¼ã‚’é¸å®š",
      "assignedTo": "Supplier"
    },
    {
      "id": "task-2",
      "description": "å¥‘ç´„æ¡ä»¶ã®ç­–å®š",
      "acceptance": "å¥‘ç´„æ›¸ã®ãƒ‰ãƒ©ãƒ•ãƒˆã‚’ä½œæˆ",
      "assignedTo": "Contract"
    },
    ...
  ]
}

âœ“ 3 å€‹ã®ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆã—ã¾ã—ãŸ

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ãƒ•ã‚§ãƒ¼ã‚º 2: Worker ãŒã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
...

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ãƒ•ã‚§ãƒ¼ã‚º 3: çµæœã®çµ±åˆ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

çµ±åˆè¦ç´„ï¼ˆæŠœç²‹ï¼‰:

> ### æœ€çµ‚å›ç­”
> - ã‚µãƒ—ãƒ©ã‚¤ãƒ¤ãƒ¼ã®ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ—ãƒ­ã‚»ã‚¹ã¯ã€æ®µéšçš„ãªãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’æ•´å‚™ã—ã€è©•ä¾¡åŸºæº–ã‚’è¨­å®šã—ã€äº¤æ¸‰ã¨å¥‘ç´„ã‚’å®Œäº†ã™ã‚‹ã“ã¨ã§ç¢ºç«‹ã§ãã¾ã™ã€‚
> - å„ã‚µãƒ—ãƒ©ã‚¤ãƒ¤ãƒ¼ã¨ã®å¥‘ç´„ç· çµå¾Œã«å¿…è¦æƒ…å ±ã‚’æ•´ç†ã—ã€ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å®Ÿè¡Œã®æº–å‚™ã‚’æ•´ãˆã¾ã™ã€‚
> - ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¶™ç¶šçš„ã«ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã—ã¦æ”¹å–„ã—ã€åŠ¹ç‡ã‚’ç¶­æŒã—ã¾ã™ã€‚
>
> ### è¦ç´„
> - ...
> - ...
> - ...
>
> ### è©³ç´°
> - task-1 (æ‹…å½“: Knowledge): ...
> - task-2 (æ‹…å½“: Sourcing): ...
>
> ### ä¸»è¦ãƒªã‚¹ã‚¯
> - ...
>
> ### æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
> - ...
>
> ### å‚è€ƒå›ç­”
> - task-1: ï¼ˆå®Ÿéš›ã®å‡ºåŠ›ã§ã¯å›ç­”å…¨æ–‡ã‚’ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã§è¡¨ç¤ºï¼‰
> - ...
```

## ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«

### TaskItem

```csharp
public record TaskItem(
    string Id,
    string Description,
    string Acceptance,
    TaskStatus Status = TaskStatus.Queued,
    string? AssignedTo = null,
    string? Notes = null
);
```

### TaskStatus

```csharp
public enum TaskStatus { Queued, Doing, Done, Blocked }
```

### TaskBoard

```csharp
public class TaskBoard
{
    public string TaskId { get; init; }
    public string Objective { get; set; }
    public List<TaskItem> Tasks { get; set; }

    public void UpdateTaskStatus(string taskId, TaskStatus newStatus, string? notes = null)
    public void AssignTask(string taskId, string worker)
}
```

## æŠ€è¡“è©³ç´°

### ä½¿ç”¨æŠ€è¡“

- **Microsoft.Agents.AI.Workflows**: ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚¨ãƒ³ã‚¸ãƒ³
- **Microsoft.Extensions.AI**: AI çµ±åˆ
- **Azure.AI.OpenAI**: Azure OpenAI ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
- **Azure.Identity**: Azure èªè¨¼

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

- Planner ã®ã‚¨ãƒ©ãƒ¼æ™‚ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¿ã‚¹ã‚¯ã‚’ä½œæˆ
- Worker ã®ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚¿ã‚¹ã‚¯ã‚’ Blocked çŠ¶æ…‹ã«æ›´æ–°
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šã«ã‚ˆã‚Šé•·æ™‚é–“ã®å®Ÿè¡Œã‚’é˜²æ­¢

### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®åˆ¶å¾¡

- å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ `AgentWorkflowBuilder` ã‚’ç”¨ã„ãŸç‹¬ç«‹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¨ã—ã¦å®Ÿè¡Œ
- ã‚¿ã‚¹ã‚¯ã¯è¨ˆç”»é †ã«é †æ¬¡å®Ÿè¡Œã•ã‚Œã€çŠ¶æ…‹æ›´æ–°ã¯ãƒ­ã‚¬ãƒ¼çµŒç”±ã§å‡ºåŠ›
- Plannerï¼å„ Workerï¼Summary ãã‚Œãã‚Œã« `Activity` ã‚’å‰²ã‚Šå½“ã¦ã€OTLP ã¸ãƒˆãƒ¬ãƒ¼ã‚¹é€ä¿¡

## æ—¢å­˜ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¨ã®æ¯”è¼ƒ

| ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼                    | ç‰¹å¾´                                   | é©ç”¨å ´é¢                 |
| ------------------------------- | -------------------------------------- | ------------------------ |
| **TaskBasedWorkflow**           | å‹•çš„è¨ˆç”» + ã‚¿ã‚¹ã‚¯ç®¡ç† + æ§‹é€ åŒ–ã‚µãƒãƒªãƒ¼ | è¤‡é›‘ãªç›®æ¨™ã‚’æ®µéšçš„ã«é”æˆ |
| **SelectiveGroupChatWorkflow**  | å‹•çš„é¸æŠœ + ä¸¦åˆ—å®Ÿè¡Œ                    | åŠ¹ç‡çš„ãªå°‚é–€å®¶æ´»ç”¨       |
| **DynamicGroupChatWorkflow** ğŸ†• | å‹•çš„é¸æŠœ + HITL                        | ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ãŒå¿…è¦ãªå ´åˆ |
| **HandoffWorkflow**             | ãƒãƒ³ãƒ‰ã‚ªãƒ•æ–¹å¼                         | å°‚é–€å®¶é–“ã®å¯¾è©±ãŒå¿…è¦     |
| **GroupChatWorkflow**           | ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ­ãƒ“ãƒ³æ–¹å¼                     | å…¨å°‚é–€å®¶ã®æ„è¦‹ãŒå¿…è¦     |

## å°†æ¥ã®æ‹¡å¼µ

- [ ] ã‚¿ã‚¹ã‚¯ã®ä¸¦åˆ—å®Ÿè¡Œã‚µãƒãƒ¼ãƒˆ
- [ ] ã‚¿ã‚¹ã‚¯é–“ã®ä¾å­˜é–¢ä¿‚ç®¡ç†
- [ ] HITL (Human-In-The-Loop) çµ±åˆ
- [ ] ã‚¿ã‚¹ã‚¯ã®å„ªå…ˆé †ä½ä»˜ã‘
- [ ] ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã¨å†é–‹æ©Ÿèƒ½
- [ ] ã‚¿ã‚¹ã‚¯å®Ÿè¡Œå±¥æ­´ã®ä¿å­˜
